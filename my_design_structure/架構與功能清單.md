# Role & Context
You are an expert Android Developer. I am providing the "App Architecture and Function List" as the Source of Truth for this project. 
When I ask you to implement features, please strictly follow the tech stack (MVVM, Room, Compose), data structures, and business logic defined in this document.

---

書單 APP 完整架構規劃與功能清單
一、完整技術架構
1. 開發環境與基礎設定
•	Android Studio: 最新穩定版本或 Canary (支援 Gemini Agent)
•	最低 SDK: API 24 (Android 7.0)
•	目標 SDK: API 34+
•	程式語言: Kotlin
•	建置系統: Gradle (Kotlin DSL 推薦)
2. 架構模式
MVVM (Model-View-ViewModel):
•	Model 層: 
o	Room Database (SQLite 封裝)
o	Entity 類別(資料實體)
o	DAO 介面(資料存取)
o	Repository (資料倉庫)
•	View 層: 
o	Jetpack Compose (推薦) 或 XML + Fragment
o	Activity
o	Composable Functions / Fragment
•	ViewModel 層: 
o	AndroidViewModel
o	LiveData / StateFlow
o	業務邏輯處理
3. 資料庫設計 (Room Database)
主要資料表:
Book (書籍)
- id: Long (Primary Key, Auto-generated)
- title: String (書名, NOT NULL)
- description: String (簡介)
- readingStatus: String (閱讀狀態: 想讀/閱讀中/已讀完)
- rating: Float (評分 0-5, nullable)
- createdAt: Long (新增時間, timestamp)
- updatedAt: Long (修改時間, timestamp)
Author (作者)
- id: Long (Primary Key, Auto-generated)
- name: String (作者名, NOT NULL)
Genre (題材)
- id: Long (Primary Key, Auto-generated)
- name: String (題材名, NOT NULL, UNIQUE)
Tag (標籤)
- id: Long (Primary Key, Auto-generated)
- name: String (標籤名, NOT NULL, UNIQUE)
BookLink (書籍連結)
- id: Long (Primary Key, Auto-generated)
- bookId: Long (Foreign Key -> Book.id, CASCADE DELETE)
- linkText: String (連結文字, NOT NULL)
- url: String (網址, NOT NULL)
AuthorLink (作者連結)
- id: Long (Primary Key, Auto-generated)
- authorId: Long (Foreign Key -> Author.id, CASCADE DELETE)
- linkText: String (連結文字, NOT NULL)
- url: String (網址, NOT NULL)
關聯資料表 (多對多關係):
BookAuthorCrossRef
- bookId: Long (Foreign Key -> Book.id, CASCADE DELETE)
- authorId: Long (Foreign Key -> Author.id, CASCADE DELETE)
- Primary Key: (bookId, authorId)
BookGenreCrossRef
- bookId: Long (Foreign Key -> Book.id, CASCADE DELETE)
- genreId: Long (Foreign Key -> Genre.id, CASCADE DELETE)
- Primary Key: (bookId, genreId)
BookTagCrossRef
- bookId: Long (Foreign Key -> Book.id, CASCADE DELETE)
- tagId: Long (Foreign Key -> Tag.id, CASCADE DELETE)
- Primary Key: (bookId, tagId)
4. 核心函式庫依賴
gradle
dependencies {
    // Room Database
    implementation "androidx.room:room-runtime:2.6.1"
    implementation "androidx.room:room-ktx:2.6.1"
    kapt "androidx.room:room-compiler:2.6.1"
    
    // ViewModel & LiveData
    implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0"
    implementation "androidx.lifecycle:lifecycle-livedata-ktx:2.7.0"
    
    // Coroutines
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3"
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"
    
    // Jetpack Compose (推薦)
    implementation platform("androidx.compose:compose-bom:2024.01.00")
    implementation "androidx.compose.ui:ui"
    implementation "androidx.compose.material3:material3"
    implementation "androidx.compose.ui:ui-tooling-preview"
    implementation "androidx.activity:activity-compose:1.8.2"
    
    // Navigation
    implementation "androidx.navigation:navigation-compose:2.7.6"
    
    // Material Design Components
    implementation "com.google.android.material:material:1.11.0"
    
    // 網頁解析 (分享功能)
    implementation "org.jsoup:jsoup:1.17.2"
    
    // DataStore (主題設定儲存)
    implementation "androidx.datastore:datastore-preferences:1.0.0"
    
    // 檔案處理 (匯出功能)
    implementation "com.google.code.gson:gson:2.10.1"
    
    // 日期時間處理
    implementation "org.jetbrains.kotlinx:kotlinx-datetime:0.5.0"
}
5. UI 組件架構
主要頁面:
1.	MainActivity (容器) 
o	Bottom Navigation Bar
o	Navigation Host
2.	BookListFragment/Screen (書籍列表) (UI參考my_books_list_5_tab_light.png)
o	RecyclerView / LazyColumn
o	SearchView
o	FAB (新增書籍)
o	排序選單
o	篩選選單
3.	BookDetailFragment/Screen (書籍詳情) (UI參考book_details.png)
o	ScrollView / LazyColumn
o	所有書籍資訊顯示
o	編輯/刪除按鈕
4.	AddEditBookFragment/Screen (新增/編輯書籍) (UI參考add_book.png)
o	表單欄位
o	ChipGroup (題材選擇)
o	AutoCompleteTextView (標籤)
o	動態連結列表
5.	AuthorListFragment/Screen (作者列表) (UI參考author_list.png)
6.	AuthorDetailFragment/Screen (作者詳情)
7.	GenreListFragment/Screen (題材列表) (UI參考browse_genres.png)
8.	GenreDetailFragment/Screen (題材詳情)
9.	TagListFragment/Screen (標籤列表) (UI參考browse_tags.png)
10.	TagDetailFragment/Screen (標籤詳情)
11.	SearchFragment/Screen (搜尋頁面) (UI參考book_search.png, book_search_no_results.png, book_search_results.png)
12.	AdvancedSearchFragment/Screen (進階搜尋) (UI參考advanced_search_filter.png)
13.	SettingsFragment/Screen (設定頁面) (UI參考setting.png, restore_data.png)
14.	ReceiveShareActivity (接收分享) (UI參考parsing_webpage_loading.png, parsing_webpage_loading_error.png)
6. 分享功能架構
組件:
•	ReceiveShareActivity: 接收分享 Intent
•	WebPageParser: 網頁解析器
•	BookDataExtractor: 書籍資訊提取
•	ShareViewModel: 處理分享邏輯
支援的網站解析器:
•	通用解析器 (Open Graph, Meta Tags)
•	Goodreads 專用解析器
•	Amazon 專用解析器
•	博客來專用解析器
•	其他可擴充...
7. 備份與還原架構
備份格式: JSON 儲存位置:
•	本地檔案 (Documents 目錄)
•	可選:雲端備份 (Google Drive API)
備份內容:
•	所有書籍資料
•	作者資料
•	題材資料
•	標籤資料
•	所有關聯關係
•	連結資料
•	時間戳記
JSON 結構:
json
{
  "version": "1.0",
  "exportDate": "2025-01-01T12:00:00Z",
  "books": [...],
  "authors": [...],
  "genres": [...],
  "tags": [...],
  "bookLinks": [...],
  "authorLinks": [...],
  "relationships": {
    "bookAuthors": [...],
    "bookGenres": [...],
    "bookTags": [...]
  }
}
```

### 8. 匯出功能架構

**支援格式**:
1. **JSON** (完整資料)
2. **CSV** (書籍清單)
3. **HTML** (可列印的書單)

**CSV 欄位**:
```
書名, 作者, 簡介, 閱讀狀態, 評分, 題材, 標籤, 連結, 新增時間, 修改時間
9. 主題系統架構
使用技術:
•	Material Design 3 Dynamic Color
•	DataStore Preferences (儲存設定)
主題選項:
•	跟隨系統
•	淺色模式
•	深色模式
實作方式:
•	Theme.xml 定義
•	ThemeManager 單例
•	DataStore 持久化
10. 排序與篩選架構
排序選項:
•	書名 (A-Z / Z-A)
•	作者 (A-Z / Z-A)
•	評分 (高到低 / 低到高)
•	新增時間 (最新 / 最舊)
•	修改時間 (最新 / 最舊)
篩選選項:
•	閱讀狀態
•	評分範圍
•	題材 (單選/多選)
•	標籤 (單選/多選)
•	有評分/無評分
實作:
•	Repository 層提供不同的查詢方法
•	ViewModel 管理排序/篩選狀態
•	UI 顯示排序/篩選選單
________________________________________
二、完整 APP 功能清單與要求
📚 核心功能
1. 書籍管理 (CRUD)
1.1 新增書籍
•	基本資訊輸入 
o	書名輸入框 (必填, TextInputLayout)
o	簡介輸入框 (多行, 可選)
o	閱讀狀態下拉選單 (想讀/閱讀中/已讀完, 必填, 預設「想讀」)
o	評分選擇器 (0-5 星, 可選, RatingBar)
o	自動記錄新增時間 (不顯示給使用者)
•	作者選擇 (多選) 
o	MaterialAutoCompleteTextView 輸入
o	輸入時即時過濾顯示相關作者 (模糊搜尋)
o	下拉選單顯示符合的作者
o	點擊選擇現有作者
o	輸入新名稱按 Enter 新增作者
o	已選作者以可移除的 Chip 顯示在上方
o	Chip 有 X 圖示可移除
o	檢查重複選擇
o	至少 0 位作者
•	題材選擇 (多選 + 新增) 
o	ChipGroup 顯示所有現有題材
o	點擊 Toggle 選中狀態
o	選中的 Chip 有視覺差異 (填充色 vs 外框)
o	下方輸入框可新增題材
o	新增後自動選中且顯示在列表中
o	檢查重複名稱
o	Enter 鍵或 + 按鈕新增
•	標籤選擇 (自動完成 + 新增) 
o	MaterialAutoCompleteTextView 輸入
o	輸入時即時過濾顯示相關標籤 (模糊搜尋)
o	下拉選單顯示符合的標籤
o	點擊選擇現有標籤
o	輸入新名稱按 Enter 新增標籤
o	已選標籤以可移除的 Chip 顯示在上方
o	Chip 有 X 圖示可移除
o	檢查重複選擇
•	書籍連結管理 (動態列表) 
o	顯示已新增的連結列表
o	每個連結項目包含: 
	連結文字輸入框 (可自訂顯示名稱)
	URL 輸入框 (驗證格式)
	刪除按鈕
o	「新增連結」按鈕
o	支援新增多個連結
o	支援重新排序 (可選)
•	表單驗證 
o	書名不可為空
o	閱讀狀態必選
o	URL 格式驗證
o	即時錯誤提示
•	儲存功能 
o	儲存按鈕
o	儲存時自動記錄新增時間
o	儲存成功顯示 Toast/Snackbar
o	返回書籍列表
•	重複書籍檢查與確認 
o	觸發時機：使用者點擊「儲存」按鈕時。
o	執行檢查：在儲存前，查詢資料庫中書名完全相同的書籍（Book.title）。
o	處理重複：
	若找到重複：彈出「同名書籍確認」對話框。
	對話框內容：顯示找到的現有書籍資訊（書名、作者、閱讀狀態、評分等）。
	選項 A (相符)：「是同一本書」 (取消本次新增，並導航至現有書籍的詳情頁，讓使用者選擇是否編輯)。
	選項 B (不同)：「是另一本同名的新書」 (關閉對話框，繼續執行儲存流程，新增此重複書名的書籍)。
o	若無重複：直接執行儲存流程。


1.2 檢視書籍
書籍列表頁面:
•	列表顯示 
o	RecyclerView / LazyColumn
o	每個項目顯示: 
	書名 (粗體, 較大字體)
	作者名稱 (逗號分隔)
	閱讀狀態 Badge (有色彩區分)
	評分星星 (如有)
	簡介預覽 (1-2 行, 可選)
o	CardView 或 Material Card 設計
o	分隔線或間距清楚
•	搜尋功能 
o	頂部 SearchView
o	即時搜尋書名
o	搜尋時顯示結果數量
o	清除搜尋按鈕
•	排序功能 
o	排序按鈕/選單
o	選項: 
	書名 A-Z
	書名 Z-A
	評分高到低
	評分低到高
	新增時間 (最新優先)
	新增時間 (最舊優先)
	修改時間 (最新優先)
	修改時間 (最舊優先)
o	記住使用者的排序偏好
•	篩選功能 
o	篩選按鈕/選單
o	選項: 
	閱讀狀態 (想讀/閱讀中/已讀完/全部)
	評分範圍 (0-5 星滑桿)
	有評分/無評分
o	顯示目前啟用的篩選條件
o	清除篩選按鈕
•	快速動作 
o	長按項目顯示快速選單: 
	編輯
	刪除
	分享 (可選)
o	滑動操作 (可選): 
	左滑刪除
	右滑編輯
•	空狀態 
o	沒有書籍時顯示提示圖示和文字
o	引導使用者新增第一本書
•	FAB (Floating Action Button) 
o	右下角新增書籍按鈕
o	點擊跳轉到新增頁面
書籍詳情頁面:
•	完整資訊顯示 
o	標題區塊: 
	書名 (大字體, 粗體)
	評分顯示 (星星 + 數字)
	閱讀狀態 Badge
o	作者區塊: 
	標題「作者」
	作者 Chip (可點擊跳轉到作者頁面)
	支援多位作者
o	簡介區塊: 
	標題「簡介」
	完整簡介文字
	可展開/收合 (如果很長)
o	題材區塊: 
	標題「題材」
	題材 Chip (可點擊查看同題材書籍)
o	標籤區塊: 
	標題「標籤」
	標籤 Chip (可點擊查看同標籤書籍)
o	連結區塊: 
	標題「相關連結」
	連結清單 (自訂文字, 可點擊開啟)
	點擊開啟瀏覽器或 WebView
o	時間資訊: 
	新增時間
	最後修改時間
	格式: YYYY-MM-DD HH:mm
•	動作按鈕 
o	編輯按鈕 (跳轉到編輯頁面)
o	刪除按鈕 (顯示確認對話框)
o	分享按鈕 (可選)
•	導航 
o	點擊作者跳轉到作者詳情
o	點擊題材跳轉到題材書籍列表
o	點擊標籤跳轉到標籤書籍列表
o	返回按鈕
1.3 編輯書籍
•	載入現有資料 
o	預填充所有欄位
o	載入已選擇的作者 (Chip 顯示為選中)
o	載入已選擇的題材 (Chip 顯示為選中)
o	載入已選擇的標籤 (Chip 顯示)
o	載入所有連結
•	編輯功能 
o	所有欄位可編輯
o	可新增/移除作者、題材、標籤
o	可新增/編輯/刪除連結
o	自動記錄修改時間
•	儲存功能 
o	更新資料庫
o	更新修改時間為當前時間
o	顯示成功訊息
o	返回詳情頁或列表頁
•	取消功能 
o	返回前確認 (如有變更)
o	放棄變更
•	重複書籍檢查與確認 
o	觸發時機：使用者點擊「儲存」按鈕時。
o	執行檢查：在儲存前，查詢資料庫中書名完全相同的書籍（Book.title）。
o	處理重複：
	若找到重複：彈出「同名書籍確認」對話框。
	對話框內容：顯示找到的現有書籍資訊（書名、作者、閱讀狀態、評分等）。
	選項 A (相符)：「是同一本書」 (取消本次新增，並導航至現有書籍的詳情頁，讓使用者選擇是否編輯)。
	選項 B (不同)：「是另一本同名的新書」 (關閉對話框，繼續執行儲存流程，新增此重複書名的書籍)。
o	若無重複：直接執行儲存流程。

1.4 刪除書籍
•	刪除確認對話框 
o	顯示警告訊息
o	顯示書名
o	確認/取消按鈕
•	刪除操作 
o	刪除書籍本身
o	CASCADE 刪除書籍連結
o	移除所有關聯 (BookAuthorCrossRef, BookGenreCrossRef, BookTagCrossRef)
o	不刪除作者、題材、標籤本身
•	視覺回饋 
o	刪除成功顯示 Snackbar
o	提供 Undo 選項 (可選, 進階功能)
o	返回列表頁
2. 作者管理 (CRUD)
2.1 新增作者
•	表單 
o	作者名輸入框 (必填)
o	作者連結管理 (動態列表, 類似書籍連結)
o	每個連結包含:連結文字、URL
o	新增連結按鈕
•	驗證 
o	作者名不可為空
o	檢查重複名稱 (可選)
o	URL 格式驗證
•	儲存 
o	新增到資料庫
o	顯示成功訊息
o	返回作者列表
•	重複作者檢查與確認 
o	觸發時機：使用者點擊「儲存」按鈕時。
o	執行檢查：在儲存前，查詢資料庫中名稱完全相同的作者（Author.name）。
o	處理重複：
	若找到重複：彈出「同名作者確認」對話框。
	對話框內容：顯示找到的現有作者資訊（作者名、相關連結、作品數量）。
	選項 A (相符)：「是同一位作者」 (取消本次新增，並導航至現有作者的詳情頁)。
	選項 B (不同)：「是另一位同名的作者」 (關閉對話框，繼續執行儲存流程，新增此重複作者名的作者)。
o	若無重複：直接執行儲存流程。


2.2 檢視作者
作者列表頁面:
•	列表顯示 
o	RecyclerView / LazyColumn
o	每個項目顯示: 
	作者名
	相關書籍數量
o	按作者名 A-Z 排序
•	搜尋功能 
o	搜尋作者名
•	FAB 
o	新增作者按鈕
•	空狀態 
o	無作者時的提示
作者詳情頁面:
•	基本資訊 
o	作者名 (大字體)
o	相關連結列表 (可點擊)
•	相關書籍 
o	標題「作品」
o	該作者的所有書籍列表
o	點擊跳轉到書籍詳情
•	動作按鈕 
o	編輯按鈕
o	刪除按鈕
2.3 編輯作者
•	載入資料 
o	預填充作者名
o	預填充所有連結
•	編輯功能 
o	修改作者名
o	新增/編輯/刪除連結
•	儲存 
o	更新資料庫
o	成功訊息
o	返回
•	重複作者檢查與確認 
o	觸發時機：使用者點擊「儲存」按鈕時。
o	執行檢查：在儲存前，查詢資料庫中名稱完全相同的作者（Author.name）。
o	處理重複：
	若找到重複：彈出「同名作者確認」對話框。
	對話框內容：顯示找到的現有作者資訊（作者名、相關連結、作品數量）。
	選項 A (相符)：「是同一位作者」 (取消本次新增，並導航至現有作者的詳情頁)。
	選項 B (不同)：「是另一位同名的作者」 (關閉對話框，繼續執行儲存流程，新增此重複作者名的作者)。
o	若無重複：直接執行儲存流程。

2.4 刪除作者
•	關聯檢查 
o	檢查是否有相關書籍
•	刪除選項 : 解除關聯 (推薦) 
o	刪除作者
o	CASCADE 刪除作者連結
o	移除與書籍的關聯 (BookAuthorCrossRef)
o	書籍保留但沒有此作者
•	確認對話框 
o	顯示警告
o	顯示影響的書籍數量
o	確認/取消
3. 題材管理 (CRUD)
3.1 新增題材
•	表單 
o	題材名輸入框 (必填)
•	驗證 
o	題材名不可為空
o	檢查重複名稱
•	儲存 
o	新增到資料庫
o	成功訊息
3.2 檢視題材
題材列表頁面:
•	列表顯示 
o	每個項目顯示: 
	題材名
	相關書籍數量
o	按題材名排序
•	搜尋功能
•	FAB
•	空狀態
題材詳情頁面:
•	基本資訊 
o	題材名 (大字體)
•	相關書籍 
o	該題材的所有書籍列表
o	點擊跳轉到書籍詳情
•	動作按鈕 
o	編輯按鈕
o	刪除按鈕
3.3 編輯題材
•	載入資料 
o	預填充題材名
•	編輯功能 
o	修改題材名
•	儲存 
o	更新資料庫
3.4 刪除題材
•	刪除操作 
o	刪除題材
o	移除與書籍的關聯 (BookGenreCrossRef)
o	不影響書籍本身
•	確認對話框 
o	顯示影響的書籍數量
4. 標籤管理 (CRUD)
4.1 新增標籤
•	表單 
o	標籤名輸入框 (必填)
•	驗證 
o	標籤名不可為空
o	檢查重複名稱
•	儲存 
o	新增到資料庫
o	成功訊息
4.2 檢視標籤
標籤列表頁面:
•	列表顯示 
o	每個項目顯示: 
	標籤名
	相關書籍數量
o	按標籤名排序
•	搜尋功能
•	FAB
•	空狀態
標籤詳情頁面:
•	基本資訊 
o	標籤名 (大字體)
•	相關書籍 
o	該標籤的所有書籍列表
o	點擊跳轉到書籍詳情
•	動作按鈕 
o	編輯按鈕
o	刪除按鈕
4.3 編輯標籤
•	載入資料 
o	預填充標籤名
•	編輯功能 
o	修改標籤名
•	儲存 
o	更新資料庫
4.4 刪除標籤
•	刪除操作 
o	刪除標籤
o	移除與書籍的關聯 (BookTagCrossRef)
o	不影響書籍本身
•	確認對話框 
o	顯示影響的書籍數量
🔍 搜尋功能
5. 基本搜尋
•	書籍搜尋 
o	搜尋書名 (模糊搜尋, LIKE '%keyword%')
o	即時顯示結果
o	高亮搜尋關鍵字 (可選)
•	作者搜尋 
o	搜尋作者名
•	題材搜尋 
o	搜尋題材名
•	標籤搜尋 
o	搜尋標籤名
•	全文搜尋 
o	搜尋書籍簡介內容
o	包含關鍵字的書籍
•	搜尋歷史 (可選) 
o	記錄最近搜尋
o	快速重複搜尋
6. 進階搜尋
•	交集搜尋 UI 
o	專門的進階搜尋頁面
o	清晰的區塊劃分
•	題材交集搜尋 
o	多選題材 (ChipGroup)
o	找出「同時包含」所有選中題材的書籍
o	顯示符合條件的書籍數量
•	標籤交集搜尋 
o	多選標籤
o	AND 邏輯
•	題材 + 標籤組合搜尋 
o	同時選擇題材和標籤
o	找出同時符合的書籍
o	例如:「題材A + 題材B + 標籤C」
•	其他篩選條件 
o	閱讀狀態
o	評分範圍
o	作者 (可選)
o	修改時間範圍 (可選)
•	搜尋結果 
o	顯示符合的書籍列表
o	顯示搜尋條件摘要
o	清除/修改條件按鈕
•	無結果狀態 
o	提示無符合條件的書籍
o	建議放寬條件
🔗 網頁解析功能 (分享功能)
7. 接收分享
•	註冊為分享目標 
o	Intent Filter 設定
o	在瀏覽器分享選單中顯示 APP 名稱和圖示
•	接收 Intent 
o	接收 ACTION_SEND
o	提取 EXTRA_TEXT (包含網址)
o	從文字中提取 URL
•	載入 UI 
o	顯示半透明 Activity
o	顯示進度指示器
o	顯示狀態文字 (連接中/下載中/解析中)
8. 網頁解析
•	網路連線檢查 
o	檢查網路狀態
o	無網路時顯示錯誤
•	URL 驗證 
o	驗證 URL 格式
o	支援 http/https
•	下載網頁 
o	使用 Jsoup 連接網頁
o	設定 User Agent
o	10 秒超時
o	錯誤處理 (IOException, timeout)
•	通用解析 
o	提取 Open Graph 標籤: 
	og:title → 書名
	og:description → 簡介
	og:image → 封面圖 (可選)
o	提取 Meta 標籤: 
	meta name="author" → 作者
	meta name="description" → 簡介
	meta name="keywords" → 標籤
•	多語言欄位識別 
o	書名關鍵字: title, book title, 書名, タイトル, 本のタイトル
o	作者關鍵字: author, authors, writer, artist, creator, 作者, 著者, 筆者, 執筆者
o	簡介關鍵字: description, summary, synopsis, about, 簡介, 內容簡介, 概要, あらすじ, 紹介
o	題材關鍵字: genre, category, type, 題材, 類型, 分類, ジャンル, カテゴリ
o	標籤關鍵字: tag, tags, keyword, label, 標籤, 關鍵字, タグ, キーワード
•	智慧提取 
o	從 HTML 元素的 class、id 屬性中尋找關鍵字
o	處理多作者 (分隔符: 逗號、頓號、slash、and、・)
o	清理和標準化文字
o	去除多餘空白
•	專用網站解析器 
o	Goodreads 解析器
o	Amazon 解析器 (US/JP/其他)
o	博客來解析器
o	誠品解析器 (可選)
o	豆瓣讀書解析器 (可選)
o	可擴充架構

9. 預填充表單
•	自動跳轉 
o	解析完成後跳轉到新增書籍頁面
o	傳遞解析結果
•	預填充欄位 
o	書名 (如有)
o	簡介 (如有)
o	作者 (如有, 自動選中或新增)
o	題材 (如有, 顯示建議但不自動選中)
o	標籤 (如有, 顯示建議但不自動選中)
o	書籍連結:自動新增來源網址,連結文字為「原始來源」
o	閱讀狀態:預設「想讀」
•	視覺標示 
o	預填充的欄位有特殊標示 (圖示或顏色)
o	顯示 Snackbar 提示:「已自動填入從網頁解析的資訊,請檢查並修改」
•	可編輯性 
o	所有預填充欄位完全可編輯
o	提供「清除自動填入」按鈕 (可選)
•	解析失敗處理 
o	無法解析時仍跳轉到新增頁面
o	只填入網址
o	顯示提示:「無法自動解析,請手動輸入」
10. 錯誤處理
•	網路錯誤 
o	顯示錯誤訊息
o	提供重試選項
o	允許手動輸入
•	超時錯誤 
o	10 秒超時提示
o	提供延長時間選項 (可選)
•	解析錯誤 
o	顯示錯誤訊息
o	仍可手動輸入
•	無效 URL 
o	顯示錯誤訊息
o	返回或手動輸入
💾 資料備份與還原
11. 備份功能
•	備份觸發 
o	設定頁面中的「備份資料」按鈕
o	選擇備份位置 (本地檔案)
o	檔案選擇器 (SAF - Storage Access Framework)
•	備份內容 
o	匯出所有書籍資料
o	匯出所有作者資料
o	匯出所有題材資料
o	匯出所有標籤資料
o	匯出所有連結資料
o	匯出所有關聯關係
o	包含時間戳記
•	備份格式 
o	JSON 格式
o	結構化、可讀性高
o	版本號標記 (支援未來升級)
•	檔案命名 
o	格式: BookList_Backup_YYYYMMDD_HHmmss.json
o	例如: BookList_Backup_20250101_120000.json
•	備份流程 
o	顯示進度對話框
o	從資料庫讀取所有資料
o	轉換為 JSON
o	寫入檔案
o	成功提示,顯示檔案路徑
•	錯誤處理 
o	權限錯誤提示
o	儲存空間不足提示
o	寫入失敗提示
12. 還原功能
•	還原觸發 
o	設定頁面中的「還原資料」按鈕
o	檔案選擇器選擇備份檔案
•	檔案驗證 
o	檢查檔案格式 (JSON)
o	檢查版本相容性
o	檢查資料完整性
•	還原選項 
o	選項 A: 清除現有資料後還原 (完全取代)
o	選項 B: 合併資料 (保留現有 + 新增備份)
o	警告對話框說明影響
•	衝突處理 
o	如果合併模式,處理重複資料，: 
	書名相同 → 進行「資料預覽與比對」
	作者名相同 → 進行「資料預覽與比對」
	題材名相同 → 使用現有題材
	標籤名相同 → 使用現有標籤
o	「資料預覽與比對」：顯示一個清單，列出備份檔案中與資料庫中「書名相似」或「作者名相同」的項目數量
o	提供一個選項，讓使用者手動取消匯入備份中的特定重複書籍(或作者)，或強制匯入。
•	還原流程 
o	顯示進度對話框
o	讀取 JSON 檔案
o	解析資料
o	寫入資料庫
o	重建關聯
o	成功提示,顯示匯入數量
•	錯誤處理 
o	檔案格式錯誤
o	資料損壞
o	寫入資料庫失敗
o	提供詳細錯誤訊息
13. 自動備份 (可選, 進階)
•	定期備份 
o	設定自動備份頻率 (每日/每週/每月)
o	WorkManager 排程
•	雲端備份 (可選) 
o	Google Drive 整合
o	自動上傳備份檔案
📤 匯出功能
14. 匯出書單
•	匯出格式選擇 
o	JSON (完整資料, 同備份格式)
o	CSV (書籍清單, Excel 可開啟)
o	HTML (可列印的書單)
•	CSV 匯出 
o	欄位: 書名, 作者, 簡介, 閱讀狀態, 評分, 題材, 標籤, 連結, 新增時間, 修改時間
o	作者欄位: 多位作者以分號或逗號分隔
o	題材欄位: 多個題材以分號分隔
o	標籤欄位: 多個標籤以分號分隔
o	連結欄位: 格式「文字:URL」,多個以分號分隔
o	UTF-8 編碼 (支援中文)
o	檔名: BookList_Export_YYYYMMDD.csv
•	HTML 匯出 
o	格式化的書籍清單
o	包含所有書籍資訊
o	表格或卡片式排版
o	CSS 樣式美化
o	可在瀏覽器中開啟
o	支援列印 (CSS print media query)
o	檔名: BookList_Export_YYYYMMDD.html
•	JSON 匯出 
o	與備份格式相同
o	檔名: BookList_Export_YYYYMMDD.json
•	匯出範圍選擇 (可選) 
o	全部書籍
o	目前篩選/搜尋結果
o	特定題材/標籤的書籍
o	特定閱讀狀態的書籍
•	匯出流程 
o	選擇格式
o	選擇儲存位置
o	顯示進度
o	產生檔案
o	成功提示,提供「開啟檔案」選項
🎨 主題切換功能
15. 主題系統
•	主題選項 
o	跟隨系統 (預設)
o	淺色模式
o	深色模式
•	設定介面 
o	在設定頁面中
o	RadioButton 或 DropDown 選擇
o	即時預覽效果
•	持久化儲存 
o	使用 DataStore Preferences
o	儲存使用者選擇
o	APP 重啟後保持設定
•	主題定義 
o	Material Design 3 Dynamic Color
o	定義 Light Theme 色彩
o	定義 Dark Theme 色彩
o	定義文字色彩、背景色、強調色等
•	主題切換 
o	即時切換,無需重啟 APP
o	平滑過渡動畫 (可選)
o	所有頁面同步更新
•	深色模式優化 
o	確保所有文字可讀
o	調整 Card、Dialog、Bottom Sheet 背景色
o	圖示適配深色背景
o	狀態列和導航列配色
16. 其他設定 (可選)
•	字體大小 
o	小/中/大/特大
o	系統輔助功能整合
•	語言切換 
o	繁體中文
o	英文
o	日文
📊 排序與篩選功能
17. 排序功能
•	排序選項 
o	書名 A-Z
o	書名 Z-A
o	作者 A-Z (依第一位作者)
o	作者 Z-A
o	評分高到低
o	評分低到高
o	新增時間 (最新優先)
o	新增時間 (最舊優先)
o	修改時間 (最新優先)
o	修改時間 (最舊優先)
•	排序 UI 
o	Toolbar 中的排序按鈕
o	點擊顯示選單或 BottomSheet
o	顯示目前排序方式
o	選擇後立即更新列表
•	排序持久化 
o	記住使用者的排序偏好 (DataStore)
o	下次開啟 APP 時套用相同排序
•	排序邏輯 
o	Repository 層提供不同查詢方法
o	SQL ORDER BY 實作
o	支援多欄位排序 (例如:評分相同時按書名)
18. 篩選功能
•	篩選選項 
o	閱讀狀態: 
	全部
	想讀
	閱讀中
	已讀完
o	評分範圍: 
	滑桿選擇 (0-5 星)
	顯示目前範圍
o	評分狀態: 
	全部
	有評分
	無評分
o	題材 (可選): 
	單選或多選
o	標籤 (可選): 
	單選或多選
o	時間範圍 (可選): 
	新增時間
	修改時間
	DatePicker 選擇
•	篩選 UI 
o	Toolbar 中的篩選按鈕
o	BottomSheet 或專門的篩選頁面
o	顯示目前啟用的篩選條件 (Badge)
o	清除所有篩選按鈕
•	篩選邏輯 
o	SQL WHERE 子句實作
o	支援多條件組合 (AND)
o	即時更新結果
•	篩選狀態顯示 
o	在列表頂部顯示篩選摘要
o	例如:「閱讀中 · 評分 3-5 星 · 漫畫」
o	Chip 形式,可點擊移除單個條件
📱 其他 UI/UX 功能
19. 導航
•	Bottom Navigation Bar 
o	4 個主要分頁: 
	書籍 (圖示: 書本)
	作者 (圖示: 人物)
	題材 (圖示: 標籤/分類)
	標籤 (圖示: 標籤)
o	第 5 個分頁 (可選): 設定 (圖示: 齒輪)
•	Toolbar/AppBar 
o	顯示目前頁面標題
o	返回按鈕 (需要時)
o	動作按鈕 (搜尋、排序、篩選等)
•	Navigation Component 
o	Fragment 間的導航
o	深層連結支援 (可選)
o	過渡動畫
20. 通用 UI 元素
•	空狀態 
o	每個列表頁面的空狀態設計
o	圖示 + 文字說明
o	引導動作按鈕
•	載入狀態 
o	ProgressBar 或 Shimmer 效果
o	資料載入時顯示
•	錯誤狀態 
o	錯誤訊息顯示
o	重試按鈕
•	下拉重新整理 
o	SwipeRefreshLayout
o	更新資料
•	對話框 
o	刪除確認
o	錯誤提示
o	Material Design 風格
•	Snackbar / Toast 
o	操作成功/失敗提示
o	短暫顯示
o	可提供 Undo 動作
21. 效能優化
•	分頁載入 (可選) 
o	Paging 3 整合
o	大量書籍時分批載入
•	圖片快取 (如有封面功能) 
o	Coil 或 Glide
•	資料庫索引 
o	常查詢欄位建立索引
•	非同步處理 
o	所有資料庫操作在背景執行
o	Coroutines 實作
🧪 測試與品質
22. 測試 (建議, 非必須)
•	Unit Test 
o	ViewModel 測試
o	Repository 測試
o	資料轉換測試
•	UI Test 
o	Espresso 測試關鍵流程
o	新增書籍流程
o	刪除確認流程
•	資料庫測試 
o	Room Database 測試
o	CRUD 操作測試
o	關聯測試
23. 資料完整性
•	CASCADE 刪除 
o	刪除書籍 → 自動刪除 BookLink
o	刪除作者 → 自動刪除 AuthorLink
o	Foreign Key 約束設定
•	ON DELETE CASCADE 
o	BookAuthorCrossRef
o	BookGenreCrossRef
o	BookTagCrossRef
•	孤兒資料清理 (可選) 
o	定期清理沒有關聯書籍的作者/題材/標籤
o	提供手動清理功能


24. 實作建議 (給初學者的提醒)
雖然文件非常完整，但在實際動手寫程式碼時，建議您按照以下順序，從核心慢慢擴張：
1.	第一階段：核心資料流
o	先建立資料庫實體（Room Entities）與 DAO。
o	實作基本的書籍列表顯示與簡單的新增功能。
2.	第二階段：重複檢查邏輯
o	在此階段加入您要求的「對話框檢查機制」，確保 UI 能根據資料庫查詢結果正確彈出警告。
3.	第三階段：關聯與細節
o	實作作者、標籤的多對多選取。
o	加入排序與篩選功能。
4.	第四階段：外部整合
o	最後才處理網頁解析分享、備份還原與 UI 主題切換。

